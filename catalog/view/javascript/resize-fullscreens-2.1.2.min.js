(function(){var b,d,c,a;c=a=d=void 0;b=(function(){function e(f){var g;this.item=f;this.viewport=Resizer;this.initProperties();if(this.images){this.images=JSON.decode(this.images)}if(this.src||this.images){if(this.images){this.src=null;this.findBestImage()}else{g=this.rewriteSrc(this.item.data("src"));this.item.data("src",g);this.item.lazyLoad(this.draw.bind(this))}}else{this.draw()}}e.prototype.resize=function(){this.draw();if(this.images){return this.findBestImage()}};e.prototype.draw=function(){this.setDimensions();this.setPosition();this.setParentClass();return this.fireResizeEvent()};e.prototype.setParentClass=function(){this.parent||(this.parent=this.item.getParent());if(this.previousParentClass){this.parent.removeClass(this.previousParentClass)}if(this.parentClass){this.parent.addClass(this.parentClass)}return this.previousParentClass=this.parentClass};e.prototype.setDimensions=function(){var f;f=(this.viewport.ratio<this.ratio?"width":"height");if(this.action==="fill"){if(f==="height"){this.height=this.viewport.height;this.width=this.viewport.height*this.ratio}else{this.width=this.viewport.width;this.height=this.viewport.width/this.ratio}}else{if(f==="height"){this.width=this.viewport.width;this.height=this.viewport.width/this.ratio}else{this.height=this.viewport.height;this.width=this.viewport.height*this.ratio}}return this.item.setStyles({height:this.height+"px",width:this.width+"px"})};e.prototype.setPosition=function(){var f=this;this.x=-(this.width-this.viewport.width)/2;this.y=-(this.height-this.viewport.height)/2;this.anchor.split(" ").each(function(g){switch(g){case"right":return f.x=-(f.width-f.viewport.width);case"left":return f.x=0;case"top":return f.y=0;case"bottom":return f.y=-(f.height-f.viewport.height)}});return this.item.setPosition({x:this.x,y:this.y})};e.prototype.setMapCoords=function(){this.map=$(this.usemap.substring(1));d=this.width/this.item.get("data-width");return this.map.getElements("area").each(function(f){var g;g=f.get("data-coords").split(",").map(function(h){return h*d});return f.set("coords",g.join(","))})};e.prototype.fireResizeEvent=function(){return window.fireEvent("Image.resize",{el:this.item,x:this.x,y:this.y,height:this.height,width:this.width,ratio:this.width/this.height,winHeight:this.viewport.height,winWidth:this.viewport.width,winRatio:this.viewport.width/this.viewport.height})};e.prototype.acceptedDataKeys=["src","usemap","images","anchor","action","ratio","parent-class","translations"];e.prototype.initProperties=function(){var f,g=this;f={anchor:"center",action:"stretch",ratio:2};return this.acceptedDataKeys.map(function(h){return g[h.camelCase()]=g.item.get("data-"+h)||f[h]})};e.prototype.fillProperties=function(f){var g=this;return this.acceptedDataKeys.map(function(h){return g[h.camelCase()]=f[h]||g[h.camelCase()]})};e.prototype.rewriteSrc=function(g){var f;f=this.computeDesirableSize(g);if(this.translations){f=this.computeTranslatedImg(f)}return f};e.prototype.replaceRegExp=/(\.[^.]+)$/;e.prototype.computeTranslatedImg=function(h){var f,g,i;i=zara.core.context.globals.langCode;f=zara.core.context.globals.countryCode.toUpperCase();g=new RegExp("\\b"+f+"_"+i+"\\b");if(g.test(this.translations)){return h.replace(this.replaceRegExp,"_"+f+"_"+i+"$1")}g=new RegExp("\\b"+f+"\\b");if(g.test(this.translations)){return h.replace(this.replaceRegExp,"_"+f+"$1")}g=new RegExp("\\bXX_"+i+"\\b");if(g.test(this.translations)){return h.replace(this.replaceRegExp,"_XX_"+i)}return h};e.prototype.computeDesirableSize=function(f){return f};e.prototype.findBestImage=function(){var i,f,g,h=this;f=Object.keys(this.images).fuzzyFind(this.viewport.ratio);i=this.images[f];g=this.rewriteSrc(i.src);if(g===this.src){return}this.item.set("data-src",g);return this.item.lazyLoad(function(){h.ratio=f;h.fillProperties(i);return h.draw()})};return e})();this.Resizer={lazyInit:function(){var e=this;this.getSize=window.getSize.bind(window);this.getScrollSize=window.getScrollSize.bind(window);window.addEvent("resize",function(){return e.resize()});if(Modernizr.touch){$$("meta[name=viewport]")[0].content="width=1024, maximum-scale=1.6"}return this.lazyInit=Function.from()},scan:function(){this.lazyInit();this.containers=$$(".fullScreen");this.updateContainersHeight();return this.images=$$(".fullImage").map(function(e){return new b(e)})},updateContainersHeight:function(){this.width=Math.max(this.getSize().x,this.getScrollSize().x);this.height=Math.max(this.getSize().y,this.getScrollSize().y);this.ratio=this.width/this.height;if(Modernizr.touch){this.ratio=this.getSize().x/this.getSize().y}this.containers.setStyle("height",this.height+"px");return window.fireEvent("Resizer.resize",{winHeight:this.height,winWidth:this.width,winRatio:this.width/this.height})},resize:function(){var e,f;this.containers.setStyles({height:"100%",width:"100%"});f=this;e=function(){f.updateContainersHeight();return f.images.each(function(g){return g.resize()})};if(Browser.ie&&Browser.version<9){return e.delay(1)}else{return e()}}};zara.extensions.push(function(){Array.implement({fuzzyFind:function(f){var e;e=this[0]||null;this.each(function(g){if(Math.abs(f-g)<Math.abs(f-e)){return e=g}});return e}});window.removeEvent("resize",window.resizeFullscreens);window.removeEvent("resize",window.resizeFullScreens);window.resizeFullscreens=Function.from();return window.resizeFullScreens=Function.from()})}).call(this);